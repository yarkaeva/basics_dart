# Асинхронность часть первая (Future)

В программе есть как минимум 1 поток - основной.
**Многопоточность** - есть несколько потоков, они выполняются в одну единицу времени. 
Например, мы хотим заблюрить 2 фотографии на 10 секунд, если эти задачи в одном потоке, то сначала заблюривается 10 секунд одна, потом 10 секунд вторая, значит обе задачи займут 20 секунд. Если задачи в разных потоках, то всё займет 10 секунд.
**Асинхронность** работает в рамках одного потока. Она позволяет не ждать результат какой-то задачи, если она не влияет на следующие задачи. Например, это нужно для загрузки файлов из интернета. 

## Класс Future
Класс `Future` представляет результат отложенной операции, которая завершит свое выполнение в будущем. Результатом операции может быть некоторое значение или ошибка.

Объект `Future` может находиться в двух состояниях: незавершенном (Uncompleted) и завершенном (Completed). В незавершенном состоянии операция, которую представляет объект `Future` определен, возможно, уже начала выполняться, но результат еще не получен. В завершенном состоянии операция уже завершила свое выполнение, ее результат - некое значение или ошибка - получен.

```dart
void main() {
  exampleOneFlow();
}

void exampleOneFlow() {
  print(1);
  print(2);
  print(3);
  // sleep(Duration(seconds: 10)); //ожидание, которое блокирует поток
  Future<Object?> waitingFuture = Future.delayed(Duration(seconds: 1)); // отложенное действие в будущем
  waitingFuture.then((_) => print(4));
  print(5);
  print(6);
  print(7);
}
```
**Консольный вывод:**
'1
2
3
5
6
7
4'

Однако, даже если 1 секунда ожидания прошла, и 4 должно вывестись, оно не будет выводиться, если поток занят вычислением кода:
```dart
void main() {
  exampleOneFlow();
}

void exampleOneFlow() {
  print(1);
  print(2);
  print(3);
  Future<Object?> waitingFuture = Future.delayed(Duration(seconds: 1)); // отложенное действие в будущем
  waitingFuture.then((_) => print(4));
  print(5);
  print(6);
  print(7);

  // хотя 1 секунда прошла, и 4 должно вывестись, оно не будет выводиться,
  // так как поток занят вычислением цикла:
  for (var i = 0; i < 99999; i++) {
    print(1);
    sleep(Duration(seconds: 1));
  }
}

```
Читаем файл с компьютера. Пока мы открываем файл, поток не прекращается.

```dart 
void main() {
  exampleTwoReadingFile();
}

void exampleTwoReadingFile() {
  print(1);
  final result = File('C:/Users/darin/Downloads/file.txt').readAsString();
  print(2);
  result.then((value) => print(value));
  print(3);
}
```

Действие с несколькими `Future`. Метод `wait` позволяет подождать завершения нескольких futures.

```dart
void main() {
  final f1 = Future.delayed(Duration(seconds: 2));
  f1.whenComplete(() => print(1));
  final f2 = Future.delayed(Duration(seconds: 5));
  f2.whenComplete(() => print(2));

  final f3 = Future.wait([f1, f2]);
  f3.then((value) => print(3));
}
```



